# yohobigfront
bigfront

开发方式依然跟我们以前的一样

npm install
===========
spm install
===========
gulp
====

不一样的地方是模拟数据的方式
============================
不再使用 public 目录下的data文件,而是移步到mockdata/jsondata下,模拟数据文件类型都是json文件
===========================================================================================
另外把路由的设置也单独出来，现在只给了routes/web ,以后可以扩展到 routes/h5,路由单独拿出来可以方便处理
=====================================================================================================

开发流程是：
----------
 1 设置好路由
 ------------
 2 创建控制器，并在里面写好处理方法
 ----------------------------------
 3 配置接口文件，接口文件在interface/interfaces.js
 -------------------------------------------------
 4 使用接口id作为模拟数据文件的名，比如接口id是 navbar,那么在 mockdata/jsondata 下创建   navbar.json
 ---------------------------------------------------------------------------------------------------
 5 在控制器里配置好视图，然后创建好视图文件，视图文件放在 view/pages下 然后启动服务，这个时候开启的是模拟数据的模式访问路由的时候数据也是通过代理获得，然后渲染视图，客户端编写仍然是sass,js模块化这些东西。
 ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 6 编写测试用例自己测试
 ----------------------
 
有关前后分离分析比较透彻的是淘宝UED的一篇连载文章。
这边可以把他们的图借过来说明一下

![Alt text](http://gtms03.alicdn.com/tps/i3/T1OMsAFApcXXaI5uU7-800-521.jpg)
图片要说明的问题就是node这块的灵活性，我们可以任意形式输出我们的内容，大大有利于前端能力的发挥。
-----------------------------------------------------------------------------------------------
图片的架构我们原本的开发架构上多加了一层MODALPROXY，这一层是专门处理与服务器通信的层，我们只是从这层获得需要渲染的数据，然后其他一切照旧
----------------------------------------------------------------------------------------------------------------------------------------
下面针对这个MODALPROXY进行详细说明：
===================================
先看下淘宝对这一层的阐释
------------------------
![Alt text](http://img2.tbcdn.cn/L1/461/1/12bb633225499cdbba656335c3ec845dec7a92b4)

    在上图中，开发者首先需要将工程项目中所有依赖的后端接口描述，按照指定的json格式，写入interface.json配置文件。必要时，需要对每个接口编写一个规则文件，也即图中interface rules部分。该规则文件用于在开发阶段mock数据或者在联调阶段使用River工具集去验证接口。规则文件的内容取决于采用哪一种mock引擎（比如 mockjs, river-mock 等等）。配置完成之后，即可在代码中按照自己的需求创建自己的业务model。
    
简单来说就是在配置文件中配置好接口参数，然后回过头来用MODALPROXY处理完这个接口文件后，方法的映射和数据都出得到，我们在需要使用数据的时候只要以接口编号为参数获取即可。
---------------------------------------------------------------------------------------------------------------------------------------------------------------------

图中的示例以使用者为视角，配置好interface.json后利用相关工具引擎生成api和接口文档，这个接口文档可以作为前后端写作开发的一个共同参照。
------------------------------------------------------------------------------------------------------------------------------------
然而图中并没有说明提供的api是否已经可以提供数据如果不可以怎么进行后续的开发 
----------------------------------------------------------------------------
假设一种情况：
我们现在没有提供好可用的数据接口，只是有了前后端共同约定的接口文档。前端想做到完全的独立开发，测试，并且在接口畅通时可以快速调用。基本省去联调这块。
----------------------------------------------------------------------------------------------------------------------------------------------------
基于这样的情况，我利用nock工具和superagent http代理工具实现这一功能。
--------------------------------------------------------------------
nock是专门模拟http的模块，通过初始化接口文档得到每一个接口的具体信息，包括路径和模拟配置。然后针对每个接口创建一个Nock模拟，模拟数据也专门存放在mockdata/jsondata路径下
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
我们配置好接口和模拟数据后启动服务，在控制启动利用yohoproxy.done(接口编号,参数,回调)的方法获得模拟数据,假如这个接口是真实畅通的就调用真实的，如果不存在就调用我们模拟的数据
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------
对于一个请求中调用了很多接口的情况我的解决方案是利用eventproxy分离异步调用，我们不必写一堆循环回调处理这么多数据。只需再满足所有数据都得到的条件后将数据整合输出给模板，然后最终渲染界面即可
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
当然还可以充分利用node的异步并行优势，以bigpipe的方式输出界面，这个例子我已经写在index.controller中
---------------------------------------------------------------------------------------------------
问题：
====
接口文档配置手动配置容易出错，可以考虑制作操作界面，减少错误，需要制作一个文档规范，后续改进中可以直接由接口自动生成文档给相关人员审阅。
---------------------------------------------------------------------------------------------------------------------------------------
异常处理不够晚上，希望所有异常全部以格式化形式输出到特定地址
------------------------------------------------------------
中间件不足，例如缺少接口参数验证插件等
----------------------------------------
测试，暂时未写出，测试时程序稳定健壮运行的重要保证
--------------------------------------------------
部署，会使用pm2部署，但仍需要内存检测报警来提醒开发人员及时解决问题
--------------------------------------------------------------------






















